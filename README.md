# Tom-Troc


### Queries Database

```
CREATE DATABASE IF NOT EXISTS tomtroc


CREATE TABLE IF NOT EXISTS authors  (
id INT(11) AUTO_INCREMENT PRIMARY KEY NOT NULL,
name VARCHAR(255) NOT NULL,
surname VARCHAR(255) NOT NULL,
pseudo VARCHAR(255) NOT NULL
)


CREATE TABLE IF NOT EXISTS users (
email VARCHAR(255) PRIMARY KEY NOT NULL,
pseudo VARCHAR(255) UNIQUE NOT NULL,
password VARCHAR(255) NOT NULL
)

ALTER TABLE users ADD COLUMN signup_date DATETIME NOT NULL DEFAULT NOW()


CREATE TABLE IF NOT EXISTS books (
id INT(11) AUTO_INCREMENT PRIMARY KEY NOT NULL,
title VARCHAR(255) NOT NULL,
author_id INT NOT NULL,
image VARCHAR(255) NOT NULL,
description TEXT NOT NULL,
status TINYINT NOT NULL DEFAULT 1,
FOREIGN KEY(author_id) REFERENCES authors(id) ON DELETE CASCADE
)


CREATE TABLE IF NOT EXISTS chatrooms (
id CHAR(36) PRIMARY KEY DEFAULT (UUID()),
main_user_id INT NOT NULL UNIQUE REFERENCES users(id),
second_user_id INT NOT NULL UNIQUE REFERENCES users(id)
)


CREATE TABLE IF NOT EXISTS messages(
id INT(11) AUTO_INCREMENT PRIMARY KEY,
chatroom_id CHAR NOT NULL,
user_one_id INT NOT NULL REFERENCES users(id),
user_two_id INT NOT NULL REFERENCES users(id),
content TEXT NOT NULL,
sent_at DATETIME NOT NULL DEFAULT NOW()

ALTER TABLE messages ADD CONSTRAINT FOREIGN KEY(chatroom_id) REFERENCES chatrooms(id)

ALTER TABLE messages MODIFY COLUMN user_one_id VARCHAR(255) NOT NULL
ALTER TABLE messages MODIFY COLUMN user_two_id VARCHAR(255) NOT NULL

ALTER TABLE messages ADD CONSTRAINT FOREIGN KEY(user_one_id) REFERENCES users(email)
ALTER TABLE messages ADD CONSTRAINT FOREIGN KEY(user_two_id) REFERENCES users(email)

ALTER TABLE chatrooms MODIFY COLUMN main_user_id VARCHAR(255) NOT NULL
ALTER TABLE chatrooms MODIFY COLUMN second_user_id VARCHAR(255) NOT NULL


ALTER TABLE users MODIFY email VARCHAR(255) NOT NULL UNIQUE;
ALTER TABLE users DROP PRIMARY KEY;

ALTER TABLE users ADD COLUMN id INT(11) AUTO_INCREMENT NOT NULL PRIMARY KEY  

)

```

